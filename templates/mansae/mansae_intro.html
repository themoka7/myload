    {% extends 'base.html' %}

    {% block title %}세상의 모든 점 올점{% endblock %}
    {% block description %}올점은 사주, 타로, 점성술, 성명학, 주역 점괘 등 세상의 모든 점술 서비스를 무료로 제공하는 웹사이트입니다. 개인 맞춤형 상담으로 여러분의 운세를 안내합니다.{% endblock %}



     {% block styles %}

    <style>

        /* 기본 테이블 스타일 */
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: right;
            vertical-align: top;
            height: 80px;
            position: relative;
        }
        th {
            background-color: #f2f2f2;
        }
        /* 11월 8일 강조 스타일 */
        .special-date {
            color: blue;
            font-weight: bold;
        }
        .event {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 12px;
            color: red;
        }

        .form-input {
            background-color: rgb(255 255 255 / 50%);
            border-radius: 8px;
            padding: 20px;
            text-align: left;
            border: solid #9b4545 2px;
            font-weight: 600;
        }
    .sub2_title {
        font-size: 20px;
        color: #741414;
        font-weight: 700;
        margin-bottom: 20px;
    }

    .lunarText{
        font-size: 12px;
        color: #636363;
    }
    .charText{
        font-size: 12px;
        color: #636363;
    }

    .month-btn {
        background-color: #741414;
        color: white;
        border: none;
        padding: 0px 10px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.1s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .month-btn:hover {
        background-color: #45a049;       /* 호버 시 색상 */
    }

    .month-btn:active {
        transform: scale(0.95);          /* 클릭 시 살짝 작아지는 효과 */
    }

    .month-btn:focus {
        outline: none;                   /* 포커스 시 테두리 제거 */
    }



    </style>


    {% endblock %}


    {% block content %}



     <div class="contain intropage">


         <div class="content">


               <div class="intro">
                    <div id="hi" class="intro_title">만세력</div>
                    <p class="first_type">올점 만세력은 한국 표준시를 기준으로 <br>양력과 음력 날짜 변환 및 24절기의 정확한 시간을 제공합니다.<br>
                   </p>
                    <p>최신 천체 데이터를 활용하여, 기존 만세력보다 더욱 정밀한 정보 확인이 가능합니다.</p>
                </div>

                <div class="form-input">

                     <div class="container">



                            <!-- 생년월일 선택 (양/음력, 년, 월, 일, 시) -->
                            <div class="row g-3 align-items-center">

                                <div class="col-12 col-md-12">
                                    <div class="row g-3">

                                        <div class="col-6 col-md-6">
                                            <select id="year" class="form-select" required="" data-gtm-form-interact-field-id="1">
                                                <option selected="" disabled="" value="">년</option>
                                                <!-- 연도 예시 -->



                                                <!-- 추가 필요시 반복 -->
                                            <option value="2024">2024</option><option value="2023">2023</option><option value="2022">2022</option><option value="2021">2021</option><option value="2020">2020</option><option value="2019">2019</option><option value="2018">2018</option><option value="2017">2017</option><option value="2016">2016</option><option value="2015">2015</option><option value="2014">2014</option><option value="2013">2013</option><option value="2012">2012</option><option value="2011">2011</option><option value="2010">2010</option><option value="2009">2009</option><option value="2008">2008</option><option value="2007">2007</option><option value="2006">2006</option><option value="2005">2005</option><option value="2004">2004</option><option value="2003">2003</option><option value="2002">2002</option><option value="2001">2001</option><option value="2000">2000</option><option value="1999">1999</option><option value="1998">1998</option><option value="1997">1997</option><option value="1996">1996</option><option value="1995">1995</option><option value="1994">1994</option><option value="1993">1993</option><option value="1992">1992</option><option value="1991">1991</option><option value="1990">1990</option><option value="1989">1989</option><option value="1988">1988</option><option value="1987">1987</option><option value="1986">1986</option><option value="1985">1985</option><option value="1984">1984</option><option value="1983">1983</option><option value="1982">1982</option><option value="1981">1981</option><option value="1980">1980</option><option value="1979">1979</option><option value="1978">1978</option><option value="1977">1977</option><option value="1976">1976</option><option value="1975">1975</option><option value="1974">1974</option><option value="1973">1973</option><option value="1972">1972</option><option value="1971">1971</option><option value="1970">1970</option><option value="1969">1969</option><option value="1968">1968</option><option value="1967">1967</option><option value="1966">1966</option><option value="1965">1965</option><option value="1964">1964</option><option value="1963">1963</option><option value="1962">1962</option><option value="1961">1961</option><option value="1960">1960</option><option value="1959">1959</option><option value="1958">1958</option><option value="1957">1957</option><option value="1956">1956</option><option value="1955">1955</option><option value="1954">1954</option><option value="1953">1953</option><option value="1952">1952</option><option value="1951">1951</option><option value="1950">1950</option><option value="1949">1949</option><option value="1948">1948</option><option value="1947">1947</option><option value="1946">1946</option><option value="1945">1945</option><option value="1944">1944</option><option value="1943">1943</option><option value="1942">1942</option><option value="1941">1941</option><option value="1940">1940</option><option value="1939">1939</option><option value="1938">1938</option><option value="1937">1937</option><option value="1936">1936</option><option value="1935">1935</option><option value="1934">1934</option><option value="1933">1933</option><option value="1932">1932</option><option value="1931">1931</option><option value="1930">1930</option></select>
                                        </div>
                                        <div class="col-6 col-md-6">
                                            <select id="month" class="form-select" required="" data-gtm-form-interact-field-id="0">
                                                <option selected="" disabled="" value="">월</option>



                                                    <!-- 1월부터 12월까지 추가 -->
                                                <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select>
                                            </div>


                                    </div>
                                </div>
                            </div>


                        </div>












    <div id="calendar" class="calender" style="padding-top: 20px; text-align: center; display: flex; flex-direction: column; align-items: center;">
        <div class="sub2_title" style="display: flex;justify-content: center;align-items: center;gap: 10px;flex-direction: column;">
            <div>
                <button class="month-btn" type="button" onclick="prevMonth()"> &lt; </button>
                <span id="year_month">2024년 8월</span>
                <button class="month-btn" type="button" onclick="nextMonth()"> &gt; </button>
            </div>
            <div id='mansaeinfo' style="    font-size: 17px;    color: #000;    font-weight: 600;">乙巳年 辛巳月</div> <!-- 이 부분을 아래로 내리기 -->
        </div>
    <table style="/* margin-top: 20px; */border-collapse: collapse;" id="calendar-table">
        <!-- 요일 헤더 -->
        <tbody>
            <tr>
                <th>일</th>
                <th>월</th>
                <th>화</th>
                <th>수</th>
                <th>목</th>
                <th>금</th>
                <th>토</th>
            </tr>
            <!-- 날짜들 -->
            <tr>
                <td></td><td></td><td></td><td>1</td><td>2</td><td>3</td><td>4</td>
            </tr>
            <tr>
                <td>5</td><td>6</td><td>7</td><td class="special-date">8<span class="event">하주</span></td><td>9</td><td>10</td><td>11</td>
            </tr>
            <tr>
                <td>12</td><td>13</td><td>14</td><td>15</td><td>16</td><td>17</td><td>18</td>
            </tr>
            <tr>
                <td>19</td><td>20</td><td>21</td><td>22</td><td>23</td><td>24</td><td>25</td>
            </tr>
            <tr>
                <td>26</td><td>27</td><td>28</td><td>29</td><td>30</td><td></td><td></td>
            </tr>
        </tbody>
    </table>
</div>


                </div>


        </div>


    </div>


    {% endblock %}

    {% block scripts %}
    <script >

        var currentMonth ;
        var currentYear;
        $(document).ready(function() {
            const today = new Date();
            currentYear = today.getFullYear(); // 현재 연도
            currentMonth = today.getMonth() + 1; // 현재 월 (0부터 시작하므로 +1 필요)




            getCalendarInfo(currentYear, currentMonth);


            $('#year, #month').change(function() {

                var selectedYear = parseInt($('#year').val(), 10);  // 선택된 연도를 정수로 변환
                var selectedMonth = parseInt($('#month').val(), 10);  // 선택된 월을 정수로 변환

                getCalendarInfo(selectedYear, selectedMonth);
            });


        })

        function prevMonth() {
            currentMonth -= 1; // 현재 월에서 1을 뺌

            if (currentMonth < 1) { // 1월에서 한 달 뺀 경우
                currentMonth = 12;  // 12월로 설정
                currentYear -= 1;   // 연도를 한 해 줄임
            }

            // 새로운 연도와 월을 사용하여 getCalendarInfo 호출
            getCalendarInfo(currentYear, currentMonth);
        }

           function nextMonth() {
            currentMonth += 1; // 현재 월에서 1을 더함

            if (currentMonth > 12) { // 12월에서 한 달을 더한 경우
                currentMonth = 1;    // 1월로 설정
                currentYear += 1;    // 연도를 한 해 늘림
            }

            // 새로운 연도와 월을 사용하여 getCalendarInfo 호출
            getCalendarInfo(currentYear, currentMonth);

        }


        function getCalendarInfo(year, month) {

               const data = { year: year, month: month };

               $.ajax({
                    url: '/mansae_process',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function(response) {
                        console.log(response);
                        $('#mansaeinfo').text(response['data']['info']+' (1일기준)');
                        generateCalendar(year, month, response['data']['results']);


                    },
                    error: function() {
                        alert("An error occurred while fetching the time.");
                    }
                });

         }


        function generateCalendar(year, month, arrayInfo){


             var yearExists = $('#year option[value="' + year + '"]').length > 0;

                if (!yearExists) {
                    // year 값이 없다면 새로운 option을 추가
                    $('#year').append('<option value="' + year + '">' + year + '</option>');
                }
            $('#year').val(year);
            $('#month').val(month);

            $('#year_month').text(`${year}년 ${month}월`);

            const calendar = document.getElementById("calendar-table");
            calendar.innerHTML = ""; // 기존 달력을 지우기

            // 테이블 생성
            const table = document.createElement("table");
            const daysOfWeek = ["일", "월", "화", "수", "목", "금", "토"];
            const headerRow = document.createElement("tr");

            // 요일 헤더 추가
            daysOfWeek.forEach(day => {
                const th = document.createElement("th");
                th.textContent = day;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            // 해당 월의 첫째 날과 마지막 날짜
            const firstDay = new Date(year, month -1, 1).getDay();
            const lastDate = new Date(year, month, 0).getDate();

            // 날짜 채우기
            let currentDay = 1;
            for (let i = 0; i < 6; i++) { // 최대 6주
                const row = document.createElement("tr");
                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement("td");
                    if (i === 0 && j < firstDay || currentDay > lastDate) {
                        cell.classList.add("empty"); // 빈 셀
                    } else {
                        const [lunarPart, charPart] = arrayInfo[currentDay].split(',');
                        cell.innerHTML = `<div>${currentDay}</div><div class="lunarText">${lunarPart.split(': ')[1]}</div><div class="charText">${charPart.split(': ')[1]}</div>`;

                        currentDay++;
                    }
                    row.appendChild(cell);
                }
                table.appendChild(row);
            }
            calendar.appendChild(table);
        } 




    </script>




    {% endblock %}