{% extends 'base.html' %}

{% block title %}사주{% endblock %}
{% block description %}올점은 사주, 타로, 점성술, 성명학, 주역 점괘 등 세상의 모든 점술 서비스를 무료로 제공하는 웹사이트입니다. 개인 맞춤형 상담으로 여러분의 운세를 안내합니다.{% endblock %}
{% block keywords %}주역, 점괘, 사주, 타로,당사주, 점성술, 성명학, 운세{% endblock %}


{% block styles %}

<style>



    .table{
        text-align: center;
        text-align: center;
        table-layout: fixed;
        /* width: 100%; */
        /* border-radius: 10px; */
        /* overflow: hidden; */
        font-weight: 600;
        border-top: solid #9b4545 2px;
        border-left: solid #9b4545 2px;
        border-right: solid #9b4545 2px;
        border-bottom: solid #9b4545 1px;
        border-collapse: separate;
        border-spacing: 0;
        border-radius: 10px;
        overflow: hidden;

    }

    .table-container {
        width: 100%; /* 전체 너비 사용 */
        max-width: 800px; /* 최대 너비를 제한 */
        margin: 0 auto; /* 화면 가운데 정렬 */
    }

    .table-container .table,
    .table-container .additional-info {
        width: 100%; /* 동일한 너비 */
    }

    .sub-container {
        width: 90%; /* 전체 너비 사용 */
        max-width: 800px; /* 최대 너비를 제한 */
        margin: 0 auto; /* 화면 가운데 정렬 */
    }

    .sub-container .table,
    .sub-container .additional-info {
        width: 90%; /* 동일한 너비 */
    }

    .additional-info {
        background-color: #f9f4ec;
        padding: 12px;
        text-align: center;
        border-radius: 10px;
        text-align: left;
        word-wrap: break-word;
        white-space: normal;
        border: solid #9b4545 2px;
        color: #333;
        background-color: rgb(247 241 231);
        font-size: 17px;
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .table thead tr th:nth-child(1) {
        background-color: #f9f4ec;
    }

    .table tbody:nth-of-type(1) tr:nth-child(1),
    .table tbody:nth-of-type(1) tr:nth-child(2) {

    }
     .table thead tr th,
     .table tbody tr td {
        background-color: #f9f4ec;
    }





    .content .intro .intro_title.sub_title{
    font-size: 25px;
    padding-top: 20px;
    }


    .centered-content {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .centered-content span {
        font-size: 1em;
        margin: 0 5px; /* 글자 간격 조절 */
    }

    .centered-content .right {
        padding-right: 10px;
        font-size:18px;
    }
     .centered-content .left {
        padding-left: 10px;
        font-size:18px;
    }

    .bottom {
        text-align: center;
        margin-top: 5px; /* 위 요소와 간격 조절 */
        font-size: 15px;
    }

    .main-text {

        height: 46px;
        width: 46px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 37px;
        font-weight: bold;
        color: #222;
    }

.yellow {
    background-color: #fbf600;
    border: solid 0.2px;
}
.green{
    background-color: #00fb13;
    border: solid 0.2px;
}
.red{
    background-color: #ff1919d1;
    border: solid 0.2px;
}
.white{
    background-color: #fff;
    border: solid 0.2px;
}
.black{
    background-color: #000000;
    color: #ffffff;
    border: solid 0.2px;
}

.canvas-container{

    align-items: center;
    justify-content: center;
    max-width: 600px; /* canvas의 너비에 맞춤 */
    height: auto;
    margin: auto; /* 화면 중앙 정렬 */
}

   .responsive-image {
            width: 100%;  /* 부모 요소의 너비에 맞춰 조정 */
            height: auto; /* 이미지 비율 유지 */
            display: block;
            margin: 0 auto;
        }

    @media screen and (max-width: 768px) {
     .content .intro .intro_title.sub_title{
        font-size: 20px;
        padding-top: 20px;
        }


       .table th, .table td {
            padding: 4px;

        }

        .bottom {
            font-size: 15px;
        }
        .centered-content .right{
            padding-right: 1px;
            font-size: 15px;
        }
        .centered-content .left{
            padding-left: 1px;
            font-size: 15px;
        }

    }




    .sub_table tbody tr td {
        font-size: 15px;
    }
    .content .intro .sub2_title{
        font-size: 20px; /* 원하는 크기로 설정 */
        color: #741414;
        font-weight: 700;
        margin-bottom: 20px;

    }
    .sub3_title{
        font-size: 15px;
        color: #741414;
        font-weight: 700;

        margin-bottom: 10px;
        margin-top: 10px;
    }
    .sub3_text{
        font-size: 15px;
    }
    #Earthly td {
        border-bottom : 0px;
    }
    #EarthlyHeaven td{
        padding: .5rem ;
    }

    .EarthlyHeavenElement {
        display: flex;
        gap: 5px;
        justify-content: center;
    }


    .scroll{

        white-space: nowrap;
        overflow: hidden; /* 스크롤바 숨기기 */
        user-select: none; /* 텍스트 선택 방지 */
    }
   .scroll table{
        width: 1000px; /* 테이블 너비 설정 */
        border-collapse: collapse;
    }
     .scroll table td {

        text-align: center;
    }

    .cell-content {
    cursor: grab; /* 마우스 커서를 손 모양으로 변경 */
        display: flex;
        flex-direction: column; /* 세로 방향으로 정렬 */
        gap: 5px; /* 각 div 간의 간격 */
        align-items: center;
        margin : 10px;

    }
    #future_10_heaven_tens .cell-content.active {
        border: solid #9b4545 2px;
        border-radius: 10px;
    }

    #future_10_earth_tens .cell-content.active {
        border: solid #9b4545 2px;
        border-radius: 10px;
    }

</style>


{% endblock %}


{% block content %}


<div class="contain chizodiac">

    <div class="content">
        <div class="intro" style="margin-bottom: 100px;">
            <!-- JSON 데이터 출력 -->
            <h1 class="intro_title">자평명리 결과</h1>



            <div class="table-container">



                <table class="table">
                    <thead>

                        <tr>
                            <th colspan="4" id="who"></th>

                        </tr>

                        <tr>
                            <th scope="col">시</th>
                            <th scope="col">일</th>
                            <th scope="col">월</th>
                            <th scope="col">년</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="Heavenly">
                            <td>
                                <div class="centered-content">
                                    <div class="right" id="ChiHeavenlyTimeFive">A</div>
                                    <div id="ChiHeavenlyTimeText">戊</div>
                                    <div class="left" id="ChiHeavenlyTimeElement">B</div>
                                </div></td>
                            <td id="ChiHeavenlyDayText"></td>
                            <td id="ChiHeavenlyMonthText"></td>
                            <td id="ChiHeavenlyYearText"></td>
                        </tr>
                        <tr id="Earthly">
                            <td id="ChiEarthlyTimeText"></td>
                            <td id="ChiEarthlyDayText"></td>
                            <td id="ChiEarthlyMonthText"></td>
                            <td id="ChiEarthlyYearText"></td>
                        </tr>
                        <tr id="EarthlyHeaven">
                            <td ><div id="EarthlyHeavenTimeElement" class="EarthlyHeavenElement"></div></td>
                             <td ><div id="EarthlyHeavenDayElement" class="EarthlyHeavenElement"></div></td>
                             <td ><div id="EarthlyHeavenMonthElement" class="EarthlyHeavenElement"></div></td>
                             <td ><div id="EarthlyHeavenYearElement" class="EarthlyHeavenElement"></div></td>

                        </tr>


                    </tbody>
                </table>


            </div>

            <div class="canvas-container">
             <h2 class="intro_title sub_title">오행의 상생상극 관계도</h2>
                <canvas id="fiveElementsCanvas" width="600px" height="550px" ></canvas>
                <br>
                <img id="canvasImage" class="responsive-image" alt="Canvas Image"/>
            </div>

             <div class="table-container">
                    <h2 class="intro_title sub2_title" >신약신강법(身弱身强法) : <span id="strength">aa</span></h2>
                    <table class="table sub_table">
                        <thead>
                            <tr>
                                <th colspan="4" id="strength_text">월지와 일지에서 힘을 얻고, , 년지나 시지에서도 도움을 받음</th>
                            </tr>
                            <tr>
                                <th scope="col">시</th>
                                <th scope="col">일</th>
                                <th scope="col">월</th>
                                <th scope="col">년</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td id="strength_time">O</td>
                                <td id="strength_day">O</td>
                                <td id="strength_month">O</td>
                                <td id="strength_year">O</td>
                            </tr>
                        </tbody>
                    </table>
            </div>

            <!-- 일간으로 보는 성격-->
            <div class="table-container">
                    <h2 class="intro_title sub2_title" id="daily_title">일간으로 보는 나의 성격 : <span id="daily_personality_name">aa</span></h2>
                    <div class="additional-info" id="daily_personality_features"></div>

            </div>
            <!-- 일간으로 보는 성격-->

             <!-- 천간/지지합-->
            <div class="table-container">
                    <h2 class="intro_title sub2_title" id="plus_title">천간 및 지지의 합 (다른 오행으로 변하는 것)</h2>
                    <div class="additional-info" id="plus_text"></div>

            </div>
             <!-- 천간/지지합-->




            <div class="table-container">
                <h2 class="intro_title sub2_title" id="plus_title">대운</h2>
                <div class="additional-info scroll" id="scrolling_heaven">
                    <table id="future_10_heaven_tens">
                        <tr>
                            <td>
                                <div class="cell-content">
                                    <div>Div 1</div>
                                    <div>Div 2</div>
                                    <div>Div 3</div>
                                    <div>Div 4</div>
                                    <div>Div 5</div>
                                </div>
                            </td>
                            <td>
                                <div class="cell-content">
                                    <div>Div 1</div>
                                    <div>Div 2</div>
                                    <div>Div 3</div>
                                    <div>Div 4</div>
                                    <div>Div 5</div>
                                </div>
                            </td>
                            <td>
                                <div class="cell-content">
                                    <div>Div 1</div>
                                    <div>Div 2</div>
                                    <div>Div 3</div>
                                    <div>Div 4</div>
                                    <div>Div 5</div>
                                </div>
                            </td>
                            <!-- 추가 셀 반복 -->
                        </tr>
                    </table>
                </div>
            </div>



            <div class="table-container">
                <h2 class="intro_title sub2_title" id="plus_title2">세운</h2>
                <div class="additional-info scroll" id="scrolling_earth">
                    <table id="future_10_earth_tens">
                        <tr>
                            <td>
                                <div class="cell-content">
                                    <div>Div 1</div>
                                    <div>Div 2</div>
                                    <div>Div 3</div>
                                    <div>Div 4</div>
                                    <div>Div 5</div>
                                </div>
                            </td>
                            <td>
                                <div class="cell-content">
                                    <div>Div 1</div>
                                    <div>Div 2</div>
                                    <div>Div 3</div>
                                    <div>Div 4</div>
                                    <div>Div 5</div>
                                </div>
                            </td>
                            <td>
                                <div class="cell-content">
                                    <div>Div 1</div>
                                    <div>Div 2</div>
                                    <div>Div 3</div>
                                    <d  iv>Div 4</div>
                                    <div>Div 5</div>
                                </div>
                            </td>
                            <!-- 추가 셀 반복 -->
                        </tr>
                    </table>
                </div>
            </div>



        </div>






    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
        $(document).ready(function() {
            showLoadingModal();

            // 10초 후 모달을 닫는 함수
            setTimeout(function() {
                closeLoadingModal();
                chizodiacSetting();
            }, 500); // 10000ms = 10초


        });


        let isDown = false;
        let startX;
        let scrollLeft;

        $(document).on('mousedown', '#future_10_heaven_tens .cell-content', function(e) {

            $('#future_10_heaven_tens .cell-content.active').removeClass('active');
            /*여기서 세운을 셋팅하면 되네*/
            $(this).addClass('active');


            /*여기서 세운을 셋팅하면 되네*/
            $(this).addClass('active');
            const hiddenData = $(this).find('div[style="hidden"]').attr('data');
            const deawon = $(this).find('div[datatype="deawon"]').attr('deawon');
            console.log(deawon);
            const dataArray = JSON.parse(hiddenData);

            $('#future_10_earth_tens tr').empty();
            dataArray.forEach((item, index) => {

                const [[key, value]] = Object.entries(item);

                //console.log(`Key: ${key}`);
                //console.log(`Value: ${value}`);




               heavenly_future = value.split('*')[0];
               Earthly_future = value.split('*')[1];

               firstPart = heavenly_future.split('|')[1].split(',')[0].split('=')[1];
               secontPart = Earthly_future.split('|')[1].split(',')[0].split('=')[1];


               $('#future_10_earth_tens tr').append(`<td>
                                <div class="cell-content">
                                    <div class='bottom' data_type='year' year=${key} >${key}</div>
                                    <div class='bottom'>${heavenly_future.split('|')[2]}</div>
                                    <div class="main-text ${firstPart === '木' ? 'green' : firstPart === '火' ? 'red' : firstPart === '土' ? 'yellow' : firstPart === '金' ? 'white' : firstPart === '水' ? 'black' : ''}">${heavenly_future.split('|')[1].split(',')[2].split('=')[1]}</div>
                                    <div class="main-text ${secontPart === '木' ? 'green' : secontPart === '火' ? 'red' : secontPart === '土' ? 'yellow' : secontPart === '金' ? 'white' : secontPart === '水' ? 'black' : ''}">${Earthly_future.split('|')[1].split(',')[2].split('=')[1]}</div>
                                    <div class='bottom'>${Earthly_future.split('|')[2]}</div>

                                </div>
                            </td>`);

            });


            isDown = true;
            $(this).closest('#scrolling_heaven').css('cursor', 'grabbing'); // 드래그 중 커서 변경
            startX = e.pageX - $(this).closest('#scrolling_heaven').offset().left;
            scrollLeft = $(this).closest('#scrolling_heaven').scrollLeft();
        });



        $(document).on('mousedown', '#future_10_earth_tens .cell-content', function(e) {

            $('#future_10_earth_tens .cell-content.active').removeClass('active');
            /*여기서 세운을 셋팅하면 되네*/
            $(this).addClass('active');


            isDown = true;
            $(this).closest('#scrolling_earth').css('cursor', 'grabbing'); // 드래그 중 커서 변경
            startX = e.pageX - $(this).closest('#scrolling_earth').offset().left;
            scrollLeft = $(this).closest('#scrolling_earth').scrollLeft();
        });

        $(document).mouseup(function() {
            isDown = false;
            $('.cell-content').css('cursor', 'grab');
        });

        $(document).on('mousemove', '#scrolling_heaven', function(e) {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - $(this).offset().left;
            const walk = (x - startX) * 1; // 이동 속도 조절
            $(this).scrollLeft(scrollLeft - walk);
        });

        $(document).on('mousemove', '#scrolling_earth', function(e) {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - $(this).offset().left;
            const walk = (x - startX) * 1; // 이동 속도 조절
            $(this).scrollLeft(scrollLeft - walk);
        });





        var elementText = '';
        var elementRatios = {};

        function chizodiacSetting(){

            var eightzodiacResult = {{ eightzodiac_result | tojson | safe }};
            console.log(eightzodiacResult);


            $('#who').text(eightzodiacResult['gender'] + ' 음력:'+eightzodiacResult['Lunar']+ ' 양력:'+eightzodiacResult['Solar']);


            $('#Heavenly').empty();
            $('#Earthly').empty();


            // 오행 카운트 초기화
            const elementCounts = {
                "木": 0,
                "火": 0,
                "土": 0,
                "金": 0,
                "水": 0
            };

           ['Time', 'Day', 'Month', 'Year'].forEach(text => {

                //천간
                elementValue = eightzodiacResult[`Heavenly${text}Element`] || '';

                firstPart=  elementValue.split(',')[0].split('=')[1]; // ',' 기준으로 분할
                secondPart=  elementValue.split(',')[1].split('=')[1]; // ',' 기준으로 분할

                tdContent = `
                    <td>
                        <div class="bottom" >${eightzodiacResult[`KorHeavenly${text}TextTenGod`] || ''}</div>

                        <div class="centered-content">
                            <div class="right">${firstPart || ''}</div>
                            <div class="main-text ${firstPart === '木' ? 'green' : firstPart === '火' ? 'red' : firstPart === '土' ? 'yellow' : firstPart === '金' ? 'white' : firstPart === '水' ? 'black' : ''}">${eightzodiacResult[`ChiHeavenly${text}Text`] || ''}</div>
                            <div class="left">${secondPart || ''}</div>
                        </div>


                    </td>
                `;
                $('#Heavenly').append(tdContent);


                if (elementCounts[firstPart] !== undefined) {
                    elementCounts[firstPart]++;
                }


                //지지
                elementValue = eightzodiacResult[`Earthly${text}Element`] || ''; // '목-양' 같은 형태의 값 가져오기

                firstPart=  elementValue.split(',')[0].split('=')[1]; // ',' 기준으로 분할
                secondPart=  elementValue.split(',')[1].split('=')[1]; // ',' 기준으로 분할


                tdContent = `
                    <td>
                        <div class="centered-content">
                            <div class="right">${firstPart || ''}</div>
                            <div class="main-text ${firstPart === '木' ? 'green' : firstPart === '火' ? 'red' : firstPart === '土' ? 'yellow' : firstPart === '金' ? 'white' : firstPart === '水' ? 'black' : ''}">${eightzodiacResult[`ChiEarthly${text}Text`] || ''}</div>
                            <div class="left">${secondPart || ''}</div>
                        </div>

                        <div class="bottom" >${eightzodiacResult[`KorEarthly${text}TextTenGod`] || ''}</div>
                    </td>
                `;
                $('#Earthly').append(tdContent);


                if (elementCounts[firstPart] !== undefined) {
                    elementCounts[firstPart]++;
                }
            });


            //지장간 넣기

            ['Time', 'Day', 'Month', 'Year'].forEach(text => {


                const elements = eightzodiacResult[`EarthlyHeaven${text}Element`].split('|');



                for (let i = 0; i < elements.length; i++) {
                    //console.log(elements[i]);
                     firstPart = elements[i].split(',')[1].split('=')[1];
                     html = `
                        <div class="bottom ${firstPart === '木' ? 'green' : firstPart === '火' ? 'red' : firstPart === '土' ? 'yellow' : firstPart === '金' ? 'white' : firstPart === '水' ? 'black' : ''}" >${elements[i].split(',')[0].split('=')[1]}</div>
                    `;
                    $(`#EarthlyHeaven${text}Element`).append(html);
                }



            });


            //지장간 넣기

            const totalElements = Object.values(elementCounts).reduce((a, b) => a + b, 0);

            // 각 오행의 비율 계산

            for (const [element, count] of Object.entries(elementCounts)) {
                let ratio = (count / totalElements * 100).toFixed(2);
                // 소수점이 0으로 끝나는 경우 소수점 제거
                elementRatios[element] = parseFloat(ratio) + "%";
            }






            elementText = eightzodiacResult['HeavenlyDayElement'].split(',')[0].split('=')[1];
            // 캔버스 그리기
            //console.log(1);
            //console.log(elementText);
            //console.log(elementRatios);
            drawCanvas();


            canvas = document.getElementById("fiveElementsCanvas");
            const img = document.getElementById("canvasImage");
            img.src = canvas.toDataURL("image/png");
            canvas.remove();

            //신약,신강
            $('#strength').text(eightzodiacResult['strength'].split('|')[0]);
            $('#strength_text').text(eightzodiacResult['strength'].split('|')[1]);

            $('#strength_time').text(eightzodiacResult['strength'].split('|')[2].split(',')[0].split('=')[1]);
            $('#strength_daye').text(eightzodiacResult['strength'].split('|')[2].split(',')[1].split('=')[1]);
            $('#strength_month').text(eightzodiacResult['strength'].split('|')[2].split(',')[2].split('=')[1]);
            $('#strength_year').text(eightzodiacResult['strength'].split('|')[2].split(',')[3].split('=')[1]);



            //일간 성격
            $('#daily_personality_name').text(eightzodiacResult['ChiHeavenlyDayText']+eightzodiacResult['ChiEarthlyDayText']);
            $('#daily_personality_features').html(`
                <div class='sub3_title'>성격</div>
                <div class='sub3_text'>${eightzodiacResult['daily_text']['features']}</div>

                <div class='sub3_title'>특징</div>
                <div class='sub3_text'>${eightzodiacResult['daily_text']['personality']}</div>`);


            var heavenlySumResult;
            if (eightzodiacResult['KorHeavenlySumResult'].length === 0) {
                heavenlySumResult = 0;
            }else{
            }
            var EarthlySumResult;
            if (eightzodiacResult['KorEarthlySumResult'].length === 0) {
                EarthlySumResult = 0;
            }


             if(eightzodiacResult['KorHeavenlySumResult'].length !== 0 || eightzodiacResult['KorEarthlySumResult'].length !== 0){

                Object.keys(eightzodiacResult['KorHeavenlySumResult']).forEach(key => {
                    //console.log(`Key: ${key}, Value:`, eightzodiacResult['KorHeavenlySumResult'][key]);
                    // 여기에 각 key에 대해 필요한 작업을 추가할 수 있습니다.
                    htmlContent = `<div class='sub3_title'>천간합-${eightzodiacResult['KorHeavenlySumResult'][key]['합화명칭']} </div>
                    <div class='sub3_text'>${eightzodiacResult['KorHeavenlySumResult'][key]['해석']}</div>`;

                    $('#plus_text').append(htmlContent);
                });

                Object.keys(eightzodiacResult['KorEarthlySumResult']).forEach(key => {
                    //console.log(`Key: ${key}, Value:`, eightzodiacResult['KorEarthlySumResult'][key]);
                    // 여기에 각 key에 대해 필요한 작업을 추가할 수 있습니다.
                    htmlContent = `<div class='sub3_title'>${eightzodiacResult['KorEarthlySumResult'][key]['합']}-${eightzodiacResult['KorEarthlySumResult'][key]['합화명칭']} </div>
                    <div class='sub3_text'>${eightzodiacResult['KorEarthlySumResult'][key]['해석']}</div>`;

                    $('#plus_text').append(htmlContent);
                });

            }



            //대운
            currentKey1 = 0 ;
            currentKey2 = 0 ;
            $('#future_10_heaven_tens tr').empty();
            const currentYear = new Date().getFullYear(); // 현재 연도 가져오기
            Object.keys(eightzodiacResult['future_10_tens']).forEach(key => {

               //console.log(`Key: ${key}, Value:`, eightzodiacResult['future_10_tens'][key]);

               heavenly_future = eightzodiacResult['future_10_tens'][key]['data'].split('*')[0];
               Earthly_future = eightzodiacResult['future_10_tens'][key]['data'].split('*')[1];

               firstPart = heavenly_future.split('|')[1].split(',')[0].split('=')[1];
               secontPart = Earthly_future.split('|')[1].split(',')[0].split('=')[1];


               $('#future_10_heaven_tens tr').append(`<td>
                                <div class="cell-content">
                                    <div class='bottom' datatype='deawon' deawon='${key}'>${key}</div>
                                    <div class='bottom'>${heavenly_future.split('|')[2]}</div>
                                    <div class="main-text ${firstPart === '木' ? 'green' : firstPart === '火' ? 'red' : firstPart === '土' ? 'yellow' : firstPart === '金' ? 'white' : firstPart === '水' ? 'black' : ''}">${heavenly_future.split('|')[1].split(',')[2].split('=')[1]}</div>
                                    <div class="main-text ${secontPart === '木' ? 'green' : secontPart === '火' ? 'red' : secontPart === '土' ? 'yellow' : secontPart === '金' ? 'white' : secontPart === '水' ? 'black' : ''}">${Earthly_future.split('|')[1].split(',')[2].split('=')[1]}</div>
                                    <div class='bottom'>${Earthly_future.split('|')[2]}</div>
                                    <div style='hidden' data='${JSON.stringify(eightzodiacResult['future_10_tens'][key]['array'])}'></div>
                                </div>
                            </td>`);





                eightzodiacResult['future_10_tens'][key]['array'].forEach((item, index) => {
                    const [[key2, value]] = Object.entries(item);
                    if(key2 == currentYear){
                        currentKey1 = key;
                        currentKey2 = key2;
                    }
                });

            });

            const targetElement = $(`.cell-content .bottom[deawon="${currentKey1}"]`);

            if (targetElement.length) {
                // 스크롤 컨테이너로 부드럽게 이동
                targetElement.parent().addClass('active');
                targetElement.parent().trigger('mousedown');
                $('#scrolling_heaven').animate({
                    scrollLeft: targetElement.position().left + $('#scrolling_heaven').scrollLeft()
                }, 100); // 800ms 동안 스크롤

            }

            const targetElement2 = $(`.cell-content .bottom[year="${currentKey2}"]`);
                console.log(targetElement2.position().left);
                if (targetElement2.length) {
                // 스크롤 컨테이너로 부드럽게 이동
                    targetElement2.parent().addClass('active');


                    var scrollPosition2 = targetElement2.offset().left - $('#scrolling_earth').offset().left + $('#scrolling_earth').scrollLeft();
                    $('#future_10_earth_tens').off('mouseenter');
                    $('#scrolling_earth').animate({
                         scrollLeft: scrollPosition2
                    }, 100); // 800ms 동안 스크롤
                }

        }






</script>

<script>


     function drawCanvas() {

        //console.log(elementText);
        //console.log(elementRatios);
            const canvas = document.getElementById("fiveElementsCanvas");
            const ctx = canvas.getContext("2d");

            // 각 요소의 위치 좌표와 색상 정의
            elements = [
                { label: '木', color: '#00fb13' },
                { label: '火', color: '#ff1919d1' },
                { label: '土', color: '#fbf600' },
                { label: '金', color: '#fff' },
                { label: '水', color: 'black' }
            ];


            const baseIndex = elements.findIndex(element => element.label === elementText);
            // 기준 요소부터 시작해 배열을 순환시키기
            elements = [...elements.slice(baseIndex), ...elements.slice(0, baseIndex)];


               // 요소별 위치 지정
            const positions = [
    { x: 290.0, y: 100.0 },       // 기준점 (맨 위)
    { x: 477.0, y: 221.0 },       // 오른쪽 위
    { x: 411.0, y: 408.0 },       // 오른쪽 아래
    { x: 169.0, y: 408.0 },       // 왼쪽 아래
    { x: 92.0, y: 221.0 }
            ];

            // 위치를 순서대로 할당
            elements =  elements.map((element, index) => ({
                ...element,
                ...positions[index]
            }));




            // 상생 (초록색 화살표) 연결 정의
            const nurturingPaths = [
                [0, 1], [1, 2], [2, 3], [3, 4], [4, 0]
            ];

            // 상극 (빨간색 직선 화살표) 연결 정의
            const controllingPaths = [
                [0, 2], [1, 3], [2, 4], [3, 0], [4, 1]
            ];

            // 원소 그리기


            elements.forEach((element, index) => {
                init_radius = 30 ;

                //radiusRange = 50 - init_radius;
                //console.log(radiusRange);
                //percentage = parseFloat(elementRatios[element.label].replace("%", ""));
                //radius = init_radius + (radiusRange * (percentage / 100));
                //console.log(radius);

                //increasePercentage = ((radius - init_radius) / radiusRange);
                //console.log('*'+increasePercentage);
                radius = init_radius;
                ctx.beginPath();
                ctx.arc(element.x, element.y, radius, 0, Math.PI * 2);
                ctx.fillStyle = element.color;
                ctx.fill();
                ctx.lineWidth = 1;
                ctx.strokeStyle = "black";
                ctx.stroke();
                ctx.closePath();


                // 텍스트 (한자) 그리기

                ctx.fillStyle = element.label === '水' ? "white" : "black";
                ctx.font = "600 35px 'Nanum Myeongjo', serif"; // 폰트 설정
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";

                ctx.fillText(element.label, element.x, element.y);

                ctx.fillStyle = "black";
                ctx.font = "600 15px 'Nanum Myeongjo', serif";
                ctx.textAlign = "center";
                if(index == 0){
                    ctx.fillText("비견/겁재", element.x, element.y+radius - 80);
                    ctx.fillText(elementRatios[element.label], element.x+60, element.y+radius - 45);
                }
                if(index == 1){
                    ctx.fillText("식신/상관", element.x, element.y+radius - 80);
                    ctx.fillText(elementRatios[element.label], element.x+60, element.y+radius - 45);
                }
                if(index == 2){
                    ctx.fillText("편재/정재", element.x, element.y+radius + 20);
                    ctx.fillText(elementRatios[element.label], element.x+60, element.y+radius - 45);}
                if(index == 3){
                    ctx.fillText("편관/정관", element.x, element.y+radius + 20);
                    ctx.fillText(elementRatios[element.label], element.x-60, element.y+radius - 45);}
                if(index == 4){
                    ctx.fillText("편인/정인", element.x, element.y+radius - 80);
                    ctx.fillText(elementRatios[element.label], element.x-60, element.y+radius - 45);
                }
            });





            // 상생 곡선 화살표 그리기
            ctx.strokeStyle = "green";
            ctx.lineWidth = 2;
            nurturingPaths.forEach(path => {
                const start = elements[path[0]];
                const end = elements[path[1]];
                drawArrow(ctx, start.x, start.y, end.x, end.y, radius + 20);
            });

            // 상극 중심에서 중심으로 직선 화살표 그리기
            ctx.strokeStyle = "red";
            ctx.lineWidth = 2;
            controllingPaths.forEach(path => {
                const start = elements[path[0]];
                const end = elements[path[1]];
                drawArrow(ctx, start.x, start.y, end.x, end.y, radius + 20);
            });

            // 직선 화살표 그리기 함수
            function drawArrow(ctx, fromx, fromy, tox, toy, offset) {
                const headlen = 10; // 화살표 길이
                const angle = Math.atan2(toy - fromy, tox - fromx);

                // 시작점과 끝점을 반지름 밖으로 이동
                const startX = fromx + offset * Math.cos(angle);
                const startY = fromy + offset * Math.sin(angle);
                const endX = tox - offset * Math.cos(angle);
                const endY = toy - offset * Math.sin(angle);

                // 화살표 그리기
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.lineTo(endX - headlen * Math.cos(angle - Math.PI / 6), endY - headlen * Math.sin(angle - Math.PI / 6));
                ctx.moveTo(endX, endY);
                ctx.lineTo(endX - headlen * Math.cos(angle + Math.PI / 6), endY - headlen * Math.sin(angle + Math.PI / 6));
                ctx.stroke();
            }




         }
    </script>


{% endblock %}
